pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
scrn = {}
p1 = {}
p2 = {}

function _init()
	show_menu()
end

function _update()
	scrn.upd()
end

function _draw()
	scrn.drw()
end

function show_menu()
	scrn.upd = update_menu
	scrn.drw = draw_menu	
end

function update_menu()
	if (btnp(4)) then run_game() end
	z_flash_count = z_flash_count + 1
end

z_flash_count = 0

function draw_menu()
	cls()
	spr(0,0,0,20,20)
	rect(0,0,127,127,12)
	rect(1,1,126,126,1)
	
	print_center("*** b i k e s ***",70,12)
	print_center("by thomas tappenden",80,14)
	print_center("player 1 - left/right ",90,12)
	print_center("player 2 - s/f",100,14)

	if z_flash_count > 45 then
		z_flash_count = 0
	elseif z_flash_count > 15 then
		print_center("press z to start",110,7)
	end
end

function run_game()
	sfx(3,1,0)
	scrn.upd = update_game
	scrn.drw = draw_game	
	p1.x = 32
	p1.y = 64
	p1.dir = 1
	p1.dead = false

	p2.x = 96
	p2.y = 64
	p2.dir = 1
	p2.dead = false

	cls()
	rect(0,0,127,127,1)
	sfx(0,0,0)
end

function update_player(player,player_num)
	local last_dir = player.dir

	if (player.dir == 1) then player.y=player.y-1 end
	if (player.dir == 2) then player.x=player.x+1 end
	if (player.dir == 3) then player.y=player.y+1 end
	if (player.dir == 4) then player.x=player.x-1 end

	if (btnp(0,player_num)) then player.dir = player.dir -1 end
	if (btnp(1,player_num)) then player.dir = player.dir +1 end

	if (player.dir > 4) then player.dir = 1 end
	if (player.dir < 1) then player.dir = 4 end

	if (player.dir != last_dir) then sfx(1,1,0) end

	if (pget(player.x,player.y) !=0) then 
	player.dead = true
	show_game_over() 
	end
end

function update_game()
	update_player(p1,0)	
	update_player(p2,1)
end

function draw_game()
	pset(p1.x,p1.y,12)
	pset(p2.x,p2.y,14)
end

function show_game_over()
	scrn.upd = update_game_over
	scrn.drw = draw_game_over
	sfx(2,0,0)
end

function update_game_over()
	if (btnp(4)) then show_menu() end
end

anim_step = 0

function draw_game_over()
	print_center("game over !",50,7)
	if (p1.dead) then
		circfill(p1.x,p1.y,anim_step/5,anim_step)
		print_center("player 2 wins",60,7)
	end

	if (p2.dead) then
		circfill(p2.x,p2.y,anim_step/5,anim_step)
		print_center("player 1 wins",60,7)
	end

	print_center("press z to reset",100,7)

	anim_step = anim_step +1
	if anim_step > 16 then anim_step = 0 end
end

function print_center(text,ypos,colour)
	print(text, 64-#text*2, ypos, colour)
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111cc100000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111cc111111111000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111cc111111111110000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011cc111111111111111000000000000000000000
ccccccccccccccccccccccccccccccccccccccccccccccccc1111111111111100000000000000000000000001ccc1111111111cccccc00000000000000000000
cccccccccccccccccccccccccccccccccccccccccccccccc11111111111111111111111100000000000000000ccc11111111cccccccc11100000000000000000
cccccccccccccccccccccccccccccccccccccccccccccc111111cc11111111111111111111000000000000000cc11111111cccc1111111111100000000000000
6666666666666666666666666666666666666666666611111111ccccc11111111111111111ccc0000000000001111111111ccc11111111111111100000000000
66666666666666666666666666666666666666666661111111111cccccc11111111111111ccccc11111111111111111111111111111111110011100000000000
6666666666666666666666666666666666666666661111111111111ccccc111111111111ccc11111111111111111111111111111111111111111110000000000
777777777777777777777777777777777777777711111cccccc111111cccc11111111111cc11111111111111111111111111111111cccccccc11110000000000
77777777777777777777777777777777777777711111cccccccc1111111ccc1111111111cc111111111111111111111111111111cccccccccccc111000000000
cccccccccccccccccccccccccccccccccccccc1111cc000000ccc111111ccc1111111111ccccccccc111111111111111111111cccc000000cccc111000000000
cccccccccccccccccccccccccccccccccccccc11ccc0000000cccc111111ccc1111111111ccccccccccccccccc11111111111cccc00000000cccc11000000000
ccccccccccccccccccccccccccccccccccccc111ccc000c00000cc111111ccc1111111111111111ccccccccccccc11111111cccc000cc00000ccc11000000000
ccccccccccccccccccccccccccccccccccccc11ccc000c000000cc1111111cc111111ccc11111111ccccccccccccc1111111cccc00ccc00000ccc11000000000
ccccccccccccccccccccccccccccccccccccc11ccc00c000000ccc1111111ccc11111ccc111111111ccccc1111cccc111111cccc00c0000000ccc11000000000
ccccccccccccccccccccccccccccccccccccc11ccc00c000000ccc1111111ccccc1111cccc11111111111111111cccc11111ccccc000000000ccc11000000000
777777777777777777777777777777777777711ccc000000000ccc11111111ccccc111cccccc1111111111111cccccc11111ccccc00000000cccc11000000000
777777777777777777777777777777777777711ccc00000000cccc1111111111ccc111111cccccccccccccccc1111cc11111ccccccc00000ccc1111000000000
6666666666666666666666666666666666666111cccc00000cccc11111111111cccccccccccccc111111111111111cc1111111cccccccccccc11111000000000
66666666666666666666666666666666666661111cccccccccc11111cccccccc11111111111111111111111111111cc111111111cccccccc11111dd000000000
c66666666666666666666666666666666666661cccccccccccccccccd000000000000000000000000dddddddddddddddd0dd1111111111111111ddd000000000
ccccccccccccccccccccccccccccccccccccccc111111111111dddddd0ddddddddddddddddddddddddddddddddddddddd0ddddddddddddddddddddd000000000
ccccccccccccccccccccccccccccccccccccccc00ddddddddddddd0000ddddddddddddddddddddddddd000000000000000dddddddddddddddddddd0000000000
00000000000000000000000000000000000000000dddddddddddd000000000000000000000000000000000000000000000dd0000000000000000000000000000
__sfx__
000100090155001550015500155001550015500155001550015500055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300000555005550055500455002550015500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000600001d0501c050190501605013050100500c05009050070500405001050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030000031500615007150071500615003150011500215004150081500b1500c1500c150091500515002150071500a1500b1500b1500a15005150091500b1500e1501015014150181501c1501f1502115022150
